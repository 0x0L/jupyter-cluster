#!/bin/bash

USAGE="usage: jupyter-docker (console | controller | engines | notebook)"

CLIENT_OPTS="-e CONTROLLER=$JUPYTER_CONTROLLER \
             -e JUPYTER_ID=$JUPYTER_ID \
             -v $JUPYTER_KEY:/id_rsa:ro \
             -v $JUPYTER_KEY_PUB:/id_rsa.pub:ro \
             $JUPYTER_MOUNT \
             $JUPYTER_IMAGE"

function run_console {
  docker run -it --rm $CLIENT_OPTS console
}

function run_engines {
  docker run -d $CLIENT_OPTS engines
}

function run_notebook {
  docker run -d -p $JUPYTER_NOTEBOOK_PORT:8888 $CLIENT_OPTS notebook
}

function run_controller {
  CONTROLLER_PORT=$(echo $JUPYTER_CONTROLLER | cut -d: -f2)
  docker run -v $JUPYTER_KEY_PUB:/id_rsa.pub:ro \
             -p $CONTROLLER_PORT:2222 \
             -d 0x0l/jupyter controller
}

ACTION=$1
case $ACTION in
    console)    run_console ;;
    controller) run_controller ;;
    engines)    run_engines ;;
    notebook)   run_notebook ;;
    *)          echo $USAGE ;;
esac
