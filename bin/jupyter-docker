#!/bin/bash

USAGE="usage: jupyter-docker (console | controller | engines | notebook)"

function start_console {
  docker run -e CONTROLLER=${JUPYTER_CONTROLLER} \
             -v ${JUPYTER_PRIVATE_KEY}:/id_rsa:ro \
             -it --rm ${JUPYTER_IMAGE} console
}

function start_controller {
  CONTROLLER_PORT=$(echo $JUPYTER_CONTROLLER | cut -d: -f2)

  docker run -v ${JUPYTER_PUBLIC_KEY}:/id_rsa.pub:ro \
             -p ${CONTROLLER_PORT}:2222 \
             -d 0x0l/notebook controller
}

function start_engines {
  docker run -e CONTROLLER=${JUPYTER_CONTROLLER} \
             -v ${JUPYTER_PRIVATE_KEY}:/id_rsa:ro \
             -d ${JUPYTER_IMAGE} engines
}

function start_notebook {
  docker run -e CONTROLLER=${JUPYTER_CONTROLLER} \
             -v ${JUPYTER_PRIVATE_KEY}:/id_rsa:ro \
             -p ${JUPYTER_NOTEBOOK_PORT}:8888 \
             -d ${JUPYTER_IMAGE} notebook
}

action=$1
case $action in
    console) start_console ;;
    controller) start_controller ;;
    engines) start_engines ;;
    notebook) start_notebook ;;
    *) echo $USAGE ;;
esac
